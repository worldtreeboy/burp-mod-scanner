package com.omnistrike.modules.exploit.omnimap;

import com.omnistrike.modules.exploit.omnimap.technique.Technique;

import java.util.ArrayList;
import java.util.EnumSet;
import java.util.List;
import java.util.Set;

/**
 * OmniMap configuration — all user-configurable options for a single exploitation run.
 * OmniMap is a high-speed sqlmap variant built into OmniStrike with parallel extraction,
 * adaptive bisection, and predictive optimization.
 */
public class OmniMapConfig {

    /** Target parameter name (e.g., "id", "username") */
    private String parameterName = "";

    /** Parameter location: "url", "body", "cookie", "header" */
    private String parameterType = "url";

    /** Which techniques to try (UNION + Error + Boolean + Time) */
    private Set<Technique> techniques = EnumSet.of(Technique.UNION, Technique.ERROR, Technique.BOOLEAN, Technique.TIME);

    /** DBMS hint — null means auto-detect */
    private String dbms = null;

    /** What to extract: "databases", "tables", "columns", "dump" */
    private String action = "databases";

    /** Target database for tables/columns/dump */
    private String targetDatabase = null;

    /** Target table for columns/dump */
    private String targetTable = null;

    /** Specific columns to dump (null = all) */
    private List<String> targetColumns = null;

    /** Payload complexity level (1-5) */
    private int level = 1;

    /** Payload intrusiveness risk (1-3) */
    private int risk = 1;

    /** Parallel extraction threads (1-10, default 5 for speed) */
    private int threads = 5;

    /** Time delay for time-based detection in seconds */
    private int timeDelay = 5;

    /** Selected tamper transforms for WAF bypass */
    private List<String> tampers = new ArrayList<>();

    /** Custom injection prefix */
    private String prefix = "";

    /** Custom injection suffix */
    private String suffix = "";

    /** Custom true-condition string for boolean blind */
    private String trueString = "";

    /** Custom false-condition string for boolean blind */
    private String falseString = "";

    /** Max rows to dump (0 = all) */
    private int dumpLimit = 0;

    // ---- Getters and Setters ----

    public String getParameterName() { return parameterName; }
    public void setParameterName(String parameterName) { this.parameterName = parameterName; }

    public String getParameterType() { return parameterType; }
    public void setParameterType(String parameterType) { this.parameterType = parameterType; }

    public Set<Technique> getTechniques() { return techniques; }
    public void setTechniques(Set<Technique> techniques) { this.techniques = techniques; }

    public String getDbms() { return dbms; }
    public void setDbms(String dbms) { this.dbms = dbms; }

    public String getAction() { return action; }
    public void setAction(String action) { this.action = action; }

    public String getTargetDatabase() { return targetDatabase; }
    public void setTargetDatabase(String targetDatabase) { this.targetDatabase = targetDatabase; }

    public String getTargetTable() { return targetTable; }
    public void setTargetTable(String targetTable) { this.targetTable = targetTable; }

    public List<String> getTargetColumns() { return targetColumns; }
    public void setTargetColumns(List<String> targetColumns) { this.targetColumns = targetColumns; }

    public int getLevel() { return level; }
    public void setLevel(int level) { this.level = Math.max(1, Math.min(5, level)); }

    public int getRisk() { return risk; }
    public void setRisk(int risk) { this.risk = Math.max(1, Math.min(3, risk)); }

    public int getThreads() { return threads; }
    public void setThreads(int threads) { this.threads = Math.max(1, Math.min(10, threads)); }

    public int getTimeDelay() { return timeDelay; }
    public void setTimeDelay(int timeDelay) { this.timeDelay = Math.max(1, Math.min(30, timeDelay)); }

    public List<String> getTampers() { return tampers; }
    public void setTampers(List<String> tampers) { this.tampers = tampers; }

    public String getPrefix() { return prefix; }
    public void setPrefix(String prefix) { this.prefix = prefix != null ? prefix : ""; }

    public String getSuffix() { return suffix; }
    public void setSuffix(String suffix) { this.suffix = suffix != null ? suffix : ""; }

    public String getTrueString() { return trueString; }
    public void setTrueString(String trueString) { this.trueString = trueString != null ? trueString : ""; }

    public String getFalseString() { return falseString; }
    public void setFalseString(String falseString) { this.falseString = falseString != null ? falseString : ""; }

    public int getDumpLimit() { return dumpLimit; }
    public void setDumpLimit(int dumpLimit) { this.dumpLimit = Math.max(0, dumpLimit); }
}
